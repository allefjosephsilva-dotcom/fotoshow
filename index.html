<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alef Jos√© (Fotoshow)</title>
  <meta name="description" content="Portf√≥lio de fotografias profissionais com √°lbuns, destaques, curtidas, coment√°rios e painel do dono para personaliza√ß√£o total." />
  <style>
    /* =============================
       DESIGN SYSTEM (CSS Vars)
    ==============================*/
    :root{
      --bg: 12 12 16;           /* base background (r g b) */
      --card: 20 20 26;         /* card background */
      --muted: 162 162 176;     /* muted text */
      --text: 238 238 244;      /* primary text */
      --primary: 120 80 255;    /* accent color */
      --accent: 255 110 84;     /* secondary accent */
      --radius: 18px;
      --blur: 12px;             /* glass blur */
      --shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: rgb(var(--text));
      background: radial-gradient(1200px 600px at 10% 10%, rgba(var(--primary), .08), transparent 50%),
                  radial-gradient(800px 500px at 90% 20%, rgba(var(--accent), .08), transparent 50%),
                  rgb(var(--bg));
      overflow-x:hidden;
    }

    a{color:inherit; text-decoration:none}
    .container{max-width:1200px; margin:0 auto; padding: clamp(16px,3vw,28px)}

    /* =============================
       NAVBAR
    ==============================*/
    .nav{
      position:sticky; top:0; z-index:1000; backdrop-filter: blur(var(--blur));
      background: linear-gradient( to bottom, rgba(0,0,0,.5), rgba(0,0,0,.2) );
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .nav-inner{ display:flex; align-items:center; justify-content:space-between; gap:16px }
    .brand{ display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.3px }
    .brand .logo{ width:36px; height:36px; display:grid; place-items:center; border-radius:12px;
      background: linear-gradient(135deg, rgba(var(--primary),1), rgba(var(--accent),1)); box-shadow: var(--shadow);
    }
    .nav-links{ display:flex; gap:12px; flex-wrap:wrap }
    .btn{ padding:10px 14px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04);
      backdrop-filter: blur(calc(var(--blur) * .7)); cursor:pointer; color:rgb(var(--text));
      transition: transform .15s ease, background .2s ease, border-color .2s ease; font-weight:600; font-size:14px;
    }
    .btn:hover{ transform: translateY(-2px); background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.22) }
    .btn.primary{ background: linear-gradient(135deg, rgba(var(--primary),.95), rgba(var(--accent),.95)); border-color: transparent }

    /* =============================
       HERO / BANNER (Ken Burns)
    ==============================*/
    .hero{ position:relative; height:64vh; min-height:420px; border-radius: clamp(18px, 3vw, 28px); overflow:hidden; box-shadow: var(--shadow); }
    .hero-slide{ position:absolute; inset:0; background-position:center; background-size:cover; opacity:0; transition: opacity 1.2s ease; }
    .hero-slide.active{ opacity:1; animation: kenburns 18s ease-in-out infinite alternate; }
    @keyframes kenburns{ from{ transform: scale(1) translate3d(0,0,0) } to{ transform: scale(1.12) translate3d(2%, -2%, 0) } }
    .hero-overlay{ position:absolute; inset:0; background: linear-gradient( to top, rgba(0,0,0,.65) 5%, rgba(0,0,0,.2) 50%, rgba(0,0,0,.1) 100% ); }
    .hero-content{ position:absolute; inset:0; display:flex; align-items:flex-end; padding: clamp(16px, 3vw, 32px); }
    .hero-title{ font-size: clamp(28px, 5vw, 56px); font-weight:900; line-height:1.05; margin:0 0 6px 0 }
    .hero-sub{ opacity:.9; max-width: 720px; margin:0 0 18px 0 }

    /* =============================
       SECTION HEADERS
    ==============================*/
    .section{ margin-top: clamp(28px, 5vw, 56px) }
    .section-header{ display:flex; align-items:end; justify-content:space-between; gap:16px; margin-bottom:18px }
    .section-title{ font-size: clamp(20px, 3.1vw, 32px); font-weight:800 }
    .muted{ color: rgb(var(--muted)); font-weight:500 }

    /* =============================
       CARDS / GRIDS
    ==============================*/
    .grid{ display:grid; gap: clamp(12px, 2vw, 18px) }
    .grid.albums{ grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)) }
    .grid.photos{ grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)) }

    .card{ position:relative; overflow:hidden; border-radius: var(--radius); background: rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08); box-shadow: var(--shadow) }
    .card .thumb{ position:relative; aspect-ratio: 4/3; background: #0f0f12; }
    .card .thumb img{ width:100%; height:100%; object-fit:cover; display:block }
    .card .meta{ padding:12px 14px; display:flex; align-items:center; justify-content:space-between; gap:12px }
    .badge{ padding:6px 10px; border-radius:999px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); font-size:12px; font-weight:700 }

    /* =============================
       LIGHTBOX
    ==============================*/
    .lightbox{ position:fixed; inset:0; background: rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index: 2000; }
    .lightbox.open{ display:flex }
    .lightbox-inner{ position:relative; width:min(96vw,1200px); height:min(86vh,800px); border-radius: 20px; overflow:hidden; background: rgba(10,10,14,.9); backdrop-filter: blur(var(--blur)); border:1px solid rgba(255,255,255,.1) }
    .lightbox img{ width:100%; height:100%; object-fit:contain; background:#000 }
    .lightbox-ui{ position:absolute; inset:0; display:flex; flex-direction:column; justify-content:space-between }
    .lightbox-top{ display:flex; justify-content:space-between; padding:10px }
    .icon-btn{ display:inline-grid; place-items:center; width:38px; height:38px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); cursor:pointer }
    .lightbox-bottom{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px }
    .like{ display:flex; align-items:center; gap:8px }
    .comment-list{ max-height: 140px; overflow:auto; padding:10px; border-radius:12px; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08) }
    .comment-list .item{ padding:8px 6px; border-bottom:1px dashed rgba(255,255,255,.08) }

    /* =============================
       OWNER PANEL
    ==============================*/
    .drawer{ position: fixed; right:0; top:0; bottom:0; width:min(420px, 96vw); background: rgba(16,16,22,.95); border-left:1px solid rgba(255,255,255,.12); backdrop-filter: blur(var(--blur)); transform: translateX(100%); transition: transform .3s ease; z-index: 1500; overflow:auto }
    .drawer.open{ transform: translateX(0) }
    .drawer h3{ margin: 18px 0 8px 0 }
    .field{ display:flex; flex-direction:column; gap:8px; margin-bottom:12px }
    .input, select, textarea{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.15); background: rgba(255,255,255,.05); color: rgb(var(--text)) }
    .pill{ display:inline-block; padding:6px 10px; border-radius:999px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); font-size:12px; margin-right:8px; margin-bottom:8px; cursor:pointer }
    .dropzone{ display:grid; place-items:center; padding:20px; border:2px dashed rgba(255,255,255,.2); border-radius:16px; background: rgba(255,255,255,.04); text-align:center }
    .album-row{ display:flex; align-items:center; gap:8px; margin:6px 0 }

    /* =============================
       MODEL OF THE WEEK
    ==============================*/
    .model-card{ display:grid; grid-template-columns: 1.1fr 1fr; gap:18px; align-items:stretch }
    .model-photo{ border-radius: 20px; overflow:hidden; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.05) }
    .model-photo img{ width:100%; height:100%; object-fit:cover }
    .model-info{ padding:16px; border-radius: 20px; background: rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08) }

    /* =============================
       RESPONSIVE
    ==============================*/
    @media (max-width: 840px){
      .model-card{ grid-template-columns: 1fr; }
      .hero{ height: 52vh; }
      .nav-links{ overflow:auto }
    }
  </style>
</head>
<body>
  <!-- =============================
       NAVBAR
  ============================== -->
  <nav class="nav">
    <div class="container nav-inner">
      <div class="brand">
        <div class="logo">üì∑</div>
        <div>
          <div>Studio Pro</div>
          <div class="muted" style="font-size:12px">Portf√≥lio Fotogr√°fico</div>
        </div>
      </div>
      <div class="nav-links">
        <a href="#home" class="btn">In√≠cio</a>
        <a href="#albums" class="btn">√Ålbuns</a>
        <a href="#highlights" class="btn">Destaques</a>
        <a href="#model" class="btn">Modelo da Semana</a>
        <a href="#contact" class="btn">Contato</a>
        <button id="ownerBtn" class="btn primary">Painel do Dono</button>
      </div>
    </div>
  </nav>

  <!-- =============================
       HERO / BANNER
  ============================== -->
  <section id="home" class="container">
    <div class="hero" id="hero">
      <!-- slides rendered by JS -->
      <div class="hero-overlay"></div>
      <div class="hero-content">
        <div>
          <h1 class="hero-title">Sua Hist√≥ria Contada em Cliques</h1>
          <p class="hero-sub muted">Explore √°lbuns din√¢micos, curta e comente fotos, e personalize todo o site no painel do dono ‚Äî temas, fundos, destaques e muito mais.</p>
          <div style="display:flex; gap:10px">
            <a href="#albums" class="btn primary">Ver √Ålbuns</a>
            <a href="#highlights" class="btn">Ver Destaques</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- =============================
       HIGHLIGHTS
  ============================== -->
  <section id="highlights" class="container section">
    <div class="section-header">
      <div>
        <div class="section-title">Fotos em Destaque</div>
        <div class="muted">Curadoria do est√∫dio ‚Äî destaque semanal</div>
      </div>
      <div>
        <span class="badge" id="highlightCount">0 fotos</span>
      </div>
    </div>
    <div class="grid photos" id="highlightsGrid"></div>
  </section>

  <!-- =============================
       ALBUMS
  ============================== -->
  <section id="albums" class="container section">
    <div class="section-header">
      <div>
        <div class="section-title">√Ålbuns</div>
        <div class="muted">Organize seus trabalhos por sess√µes e temas</div>
      </div>
      <div>
        <button class="btn" id="newAlbumBtn">+ Novo √Ålbum</button>
      </div>
    </div>
    <div class="grid albums" id="albumsGrid"></div>
  </section>

  <!-- =============================
       ALBUM VIEW (dynamic)
  ============================== -->
  <section id="albumView" class="container section" style="display:none">
    <div class="section-header">
      <div>
        <div class="section-title" id="albumTitle">√Ålbum</div>
        <div class="muted" id="albumSubtitle">Gerencie e visualize as fotos deste √°lbum</div>
      </div>
      <div>
        <button class="btn" id="backToAlbums">‚Üê Voltar aos √°lbuns</button>
      </div>
    </div>
    <div class="grid photos" id="albumPhotos"></div>
  </section>

  <!-- =============================
       MODEL OF THE WEEK
  ============================== -->
  <section id="model" class="container section">
    <div class="section-header">
      <div>
        <div class="section-title">Modelo da Semana</div>
        <div class="muted">Destaque especial</div>
      </div>
      <div>
        <span class="badge" id="modelBadge">Atualize no painel</span>
      </div>
    </div>
    <div class="model-card">
      <div class="model-photo" id="modelPhotoWrap">
        <img id="modelPhoto" alt="Modelo da semana" src=""/>
      </div>
      <div class="model-info">
        <h2 id="modelName">Nome do(a) modelo</h2>
        <p class="muted" id="modelBio">Biografia curta e links do destaque da semana.</p>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:8px">
          <a class="btn primary" id="modelLink" target="_blank" rel="noopener">Ver Portf√≥lio</a>
          <button class="btn" id="featureModelBtn">Tornar foto destaque</button>
        </div>
      </div>
    </div>
  </section>

  <!-- =============================
       CONTACT / FOOTER
  ============================== -->
  <section id="contact" class="container section">
    <div class="section-header">
      <div>
        <div class="section-title">Contato</div>
        <div class="muted">Agende seu ensaio</div>
      </div>
    </div>
    <div class="card" style="padding:16px">
      <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:16px">
        <div class="field">
          <label>Seu nome</label>
          <input class="input" placeholder="Seu nome"/>
        </div>
        <div class="field">
          <label>Seu e-mail</label>
          <input class="input" type="email" placeholder="email@exemplo.com"/>
        </div>
        <div class="field" style="grid-column: 1 / -1">
          <label>Sua mensagem</label>
          <textarea class="input" rows="4" placeholder="Conte sobre o projeto..."></textarea>
        </div>
      </div>
      <div style="display:flex; justify-content:flex-end; margin-top:10px">
        <button class="btn primary">Enviar mensagem</button>
      </div>
    </div>
    <div style="text-align:center; margin-top: 24px" class="muted">¬© <span id="year"></span> Studio Pro ‚Äî Feito com ‚ô•</div>
  </section>

  <!-- =============================
       LIGHTBOX (global)
  ============================== -->
  <div class="lightbox" id="lightbox">
    <div class="lightbox-inner">
      <img id="lightboxImg" alt="Visualiza√ß√£o" />
      <div class="lightbox-ui">
        <div class="lightbox-top">
          <button class="icon-btn" id="lbClose" title="Fechar">‚úï</button>
          <div style="display:flex; gap:8px">
            <button class="icon-btn" id="lbPrev" title="Anterior">‚ü®</button>
            <button class="icon-btn" id="lbNext" title="Pr√≥xima">‚ü©</button>
          </div>
        </div>
        <div class="lightbox-bottom">
          <div class="like">
            <button class="btn" id="lbLike">‚ù§ Curtir</button>
            <span class="badge" id="lbLikes">0</span>
          </div>
          <div style="flex:1"></div>
          <div style="display:flex; gap:8px; align-items:center">
            <button class="btn" id="lbCommentBtn">üí¨ Coment√°rios</button>
            <span class="badge" id="lbComments">0</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- =============================
       OWNER PANEL (Drawer)
  ============================== -->
  <aside id="drawer" class="drawer">
    <div class="container">
      <h2 style="margin:16px 0 6px 0">Painel do Dono</h2>
      <p class="muted" style="margin-top:0">Personalize o site, gerencie √°lbuns e destaques. <strong>Senha:</strong> <code>alef1235</code></p>

      <div id="ownerAuth" class="card" style="padding:16px; margin: 14px 0">
        <div class="field">
          <label>Insira a senha do dono</label>
          <input id="ownerPass" class="input" type="password" placeholder="Senha" />
        </div>
        <button id="ownerLogin" class="btn primary">Entrar</button>
        <span id="ownerStatus" class="badge" style="margin-left:10px">Deslogado</span>
      </div>

      <div id="ownerArea" style="display:none">
        <!-- THEME SETTINGS -->
        <div class="card" style="padding:16px; margin-bottom:16px">
          <h3>Tema & Fundo</h3>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
            <div class="field">
              <label>Paleta (cor prim√°ria)</label>
              <select id="themeSelect" class="input">
                <option value="120 80 255|255 110 84">Violeta / Coral</option>
                <option value="0 168 255|0 242 195">Azul / Mint</option>
                <option value="255 92 135|255 190 118">Magenta / P√™ssego</option>
                <option value="255 170 0|255 80 80">√Çmbar / Carmim</option>
                <option value="120 255 120|100 200 255">Lima / Sky</option>
              </select>
            </div>
            <div class="field">
              <label>Fundo (imagem)</label>
              <input id="bgImageInput" type="file" accept="image/*" class="input" />
              <small class="muted">Opcional. Usa gradientes por padr√£o.</small>
            </div>
            <div class="field">
              <label>Vidro (blur) px</label>
              <input id="blurRange" type="range" min="0" max="28" value="12" />
            </div>
          </div>
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
            <button class="btn" id="applyTheme">Aplicar Tema</button>
            <button class="btn" id="resetTheme">Resetar</button>
          </div>
        </div>

        <!-- ALBUMS MGMT -->
        <div class="card" style="padding:16px; margin-bottom:16px">
          <h3>Gerenciar √Ålbuns</h3>
          <div class="field">
            <label>Novo √°lbum</label>
            <div style="display:flex; gap:8px">
              <input id="albumName" class="input" placeholder="Ex.: Ensaio Urbano" />
              <button id="createAlbum" class="btn">Criar</button>
            </div>
          </div>
          <div id="albumsList"></div>
        </div>

        <!-- UPLOAD -->
        <div class="card" style="padding:16px; margin-bottom:16px">
          <h3>Upload de Fotos</h3>
          <div class="field">
            <label>√Ålbum de destino</label>
            <select id="uploadAlbum" class="input"></select>
          </div>
          <div class="dropzone" id="dropzone">Solte arquivos aqui ou clique para selecionar</div>
          <input type="file" id="fileInput" accept="image/*" multiple hidden />
          <div class="muted" style="margin-top:8px">As fotos s√£o salvas localmente (IndexedDB) no seu navegador em alta qualidade.</div>
        </div>

        <!-- HIGHLIGHTS MGMT -->
        <div class="card" style="padding:16px; margin-bottom:16px">
          <h3>Fotos em Destaque</h3>
          <div class="muted">Marque/desmarque fotos como destaque diretamente nos √°lbuns ou use o bot√£o abaixo.</div>
          <button id="rebuildHighlights" class="btn">Atualizar grade de destaques</button>
        </div>

        <!-- MODEL OF THE WEEK MGMT -->
        <div class="card" style="padding:16px; margin-bottom:16px">
          <h3>Modelo da Semana</h3>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
            <div class="field">
              <label>Nome</label>
              <input id="modelNameInput" class="input" placeholder="Nome do(a) modelo" />
            </div>
            <div class="field">
              <label>Link</label>
              <input id="modelLinkInput" class="input" placeholder="https://instagram.com/..." />
            </div>
            <div class="field" style="grid-column:1 / -1">
              <label>Bio</label>
              <textarea id="modelBioInput" class="input" rows="3" placeholder="Biografia curta"></textarea>
            </div>
            <div class="field" style="grid-column:1 / -1">
              <label>Foto do modelo</label>
              <input id="modelPhotoInput" type="file" accept="image/*" class="input" />
            </div>
          </div>
          <div style="margin-top:10px">
            <button id="saveModel" class="btn primary">Salvar Modelo</button>
          </div>
        </div>

        <!-- UTILITIES -->
        <div class="card" style="padding:16px; margin-bottom:16px">
          <h3>Utilit√°rios</h3>
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <button id="exportData" class="btn">Exportar dados</button>
            <input id="importFile" type="file" accept="application/json" hidden />
            <button id="importData" class="btn">Importar dados</button>
            <button id="clearAll" class="btn" title="Cuidado!">Limpar tudo</button>
          </div>
        </div>

      </div>
    </div>
  </aside>

  <script>
    /* ======================================================
       DATA LAYER ‚Äî localStorage + IndexedDB (fotos em blob)
    =======================================================*/
    const DB_NAME = 'PhotoSiteDB';
    const DB_STORE = 'photos';

    function openDB(){
      return new Promise((resolve, reject)=>{
        const req = indexedDB.open(DB_NAME, 1);
        req.onupgradeneeded = ()=>{
          const db = req.result;
          if(!db.objectStoreNames.contains(DB_STORE)){
            db.createObjectStore(DB_STORE, { keyPath: 'id' });
          }
        };
        req.onsuccess = ()=> resolve(req.result);
        req.onerror = ()=> reject(req.error);
      });
    }
    async function idbPut(record){
      const db = await openDB();
      return new Promise((resolve, reject)=>{
        const tx = db.transaction(DB_STORE, 'readwrite');
        tx.objectStore(DB_STORE).put(record);
        tx.oncomplete = ()=> resolve();
        tx.onerror = ()=> reject(tx.error);
      });
    }
    async function idbGet(id){
      const db = await openDB();
      return new Promise((resolve, reject)=>{
        const tx = db.transaction(DB_STORE, 'readonly');
        const req = tx.objectStore(DB_STORE).get(id);
        req.onsuccess = ()=> resolve(req.result);
        req.onerror = ()=> reject(req.error);
      });
    }
    async function idbDelete(id){
      const db = await openDB();
      return new Promise((resolve, reject)=>{
        const tx = db.transaction(DB_STORE, 'readwrite');
        tx.objectStore(DB_STORE).delete(id);
        tx.oncomplete = ()=> resolve();
        tx.onerror = ()=> reject(tx.error);
      });
    }

    const store = {
      key: 'siteData_v1',
      load(){
        const raw = localStorage.getItem(this.key);
        if(raw){
          try{ return JSON.parse(raw) }catch(e){} 
        }
        return { albums: {}, photos: {}, highlights: [], likes:{}, comments:{}, theme:{}, model:{} };
      },
      save(data){ localStorage.setItem(this.key, JSON.stringify(data)) }
    }

    let state = store.load();

    function uid(){ return 'id_' + Math.random().toString(36).slice(2) + Date.now().toString(36) }

    /* ======================================================
       UI HELPERS
    =======================================================*/
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg; t.style.position='fixed'; t.style.bottom='16px'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.background='rgba(0,0,0,.8)'; t.style.color='#fff'; t.style.padding='10px 14px'; t.style.borderRadius='12px'; t.style.zIndex=3000; t.style.border='1px solid rgba(255,255,255,.15)';
      document.body.appendChild(t); setTimeout(()=> t.remove(), 1800);
    }

    /* ======================================================
       HERO SLIDES (usa destaques quando houver)
    =======================================================*/
    const hero = $('#hero');
    let heroIndex = 0, heroTimer;

    async function buildHero(){
      // usa at√© 4 fotos de destaque se houver
      const ids = state.highlights.slice(0,4);
      hero.innerHTML = '<div class="hero-overlay"></div>' + hero.innerHTML.split('<div class="hero-overlay"></div>')[1];
      if(ids.length){
        for(const id of ids){
          const rec = await idbGet(id);
          if(!rec) continue;
          const url = URL.createObjectURL(rec.blob);
          const slide = document.createElement('div');
          slide.className = 'hero-slide';
          slide.style.backgroundImage = `url(${url})`;
          hero.prepend(slide);
        }
      } else {
        // slides de fallback (gradientes)
        for(let i=0;i<3;i++){
          const slide = document.createElement('div');
          slide.className='hero-slide';
          slide.style.backgroundImage = `linear-gradient(135deg, rgba(var(--primary),.4), rgba(var(--accent),.4))`;
          hero.prepend(slide);
        }
      }
      cycleHero();
    }
    function cycleHero(){
      const slides = $$('.hero-slide');
      slides.forEach(s=> s.classList.remove('active'));
      if(!slides.length) return;
      slides[heroIndex % slides.length].classList.add('active');
      clearTimeout(heroTimer);
      heroTimer = setTimeout(()=>{ heroIndex++; cycleHero(); }, 6000);
    }

    /* ======================================================
       RENDER: √ÅLBUNS, FOTOS, DESTAQUES
    =======================================================*/
    function renderAlbums(){
      const wrap = $('#albumsGrid'); wrap.innerHTML = '';
      const entries = Object.values(state.albums);
      if(!entries.length){
        const empty = document.createElement('div');
        empty.className='card'; empty.style.padding='16px';
        empty.innerHTML = '<div class="muted">Nenhum √°lbum criado ainda. Use o Painel do Dono ‚Üí Gerenciar √Ålbuns.</div>';
        wrap.appendChild(empty); return;
      }
      for(const alb of entries){
        const card = document.createElement('div'); card.className='card';
        const thumb = document.createElement('div'); thumb.className='thumb';
        if(alb.cover){
          idbGet(alb.cover).then(rec=>{
            if(rec){ const url = URL.createObjectURL(rec.blob); thumb.innerHTML = `<img src="${url}" alt="Capa do √°lbum"/>`; }
          });
        }
        const meta = document.createElement('div'); meta.className='meta';
        const count = Object.values(state.photos).filter(p=> p.albumId===alb.id).length;
        meta.innerHTML = `<div style="font-weight:800">${alb.name}</div><div class="badge">${count} fotos</div>`;
        card.append(thumb, meta);
        card.style.cursor='pointer';
        card.addEventListener('click', ()=> openAlbum(alb.id));
        wrap.appendChild(card);
      }
    }

    async function renderHighlights(){
      const wrap = $('#highlightsGrid'); wrap.innerHTML = '';
      const ids = state.highlights;
      $('#highlightCount').textContent = ids.length + ' fotos';
      for(const id of ids){
        const rec = await idbGet(id); if(!rec) continue;
        const url = URL.createObjectURL(rec.blob);
        const card = photoCard(id, url, state.photos[id]);
        wrap.appendChild(card);
      }
    }

    async function openAlbum(albumId){
      $('#albums').style.display='none';
      $('#albumView').style.display='block';
      const alb = state.albums[albumId];
      $('#albumTitle').textContent = alb?.name || '√Ålbum';
      $('#albumSubtitle').textContent = 'Gerencie e visualize as fotos deste √°lbum';
      const wrap = $('#albumPhotos'); wrap.innerHTML='';
      const items = Object.entries(state.photos).filter(([,p])=> p.albumId===albumId).map(([id,p])=>({id,meta:p}));
      for(const {id, meta} of items){
        const rec = await idbGet(id); if(!rec) continue; const url = URL.createObjectURL(rec.blob);
        wrap.appendChild(photoCard(id, url, meta, true));
      }
    }

    $('#backToAlbums').addEventListener('click', ()=>{
      $('#albumView').style.display='none';
      $('#albums').style.display='block';
    });

    function photoCard(id, url, meta={}, showManage=false){
      const card = document.createElement('div'); card.className='card';
      const thumb = document.createElement('div'); thumb.className='thumb';
      const img = new Image(); img.src=url; img.alt='Foto';
      thumb.appendChild(img);
      const metaDiv = document.createElement('div'); metaDiv.className='meta';
      const likeCount = state.likes[id]||0;
      const comments = (state.comments[id]||[]).length;
      metaDiv.innerHTML = `
        <div style="display:flex; gap:8px; align-items:center">
          <button class="btn" data-like>‚ù§ ${likeCount}</button>
          <span class="badge">üí¨ ${comments}</span>
        </div>
        <div style="display:flex; gap:8px; align-items:center">
          ${ showManage ? '<span class="pill" data-feature>'+ (state.photos[id]?.featured?'‚òÖ Destaque':'‚òÜ Destaque') +'</span>' : '' }
          ${ showManage ? '<span class="pill" data-cover>Definir capa</span>' : '' }
        </div>`;
      card.append(thumb, metaDiv);
      // open lightbox
      img.style.cursor='zoom-in';
      img.addEventListener('click', ()=> openLightbox(id));
      // like
      metaDiv.querySelector('[data-like]').addEventListener('click', ()=> likePhoto(id));
      if(showManage){
        const feat = metaDiv.querySelector('[data-feature]');
        feat.addEventListener('click', ()=> toggleFeature(id));
        const cov = metaDiv.querySelector('[data-cover]');
        cov.addEventListener('click', ()=> setAlbumCover(id));
      }
      return card;
    }

    function likePhoto(id){
      state.likes[id] = (state.likes[id]||0) + 1; store.save(state); updateCounts(id);
    }
    function toggleFeature(id){
      state.photos[id].featured = !state.photos[id].featured; store.save(state);
      if(state.photos[id].featured && !state.highlights.includes(id)) state.highlights.push(id);
      if(!state.photos[id].featured) state.highlights = state.highlights.filter(x=> x!==id);
      renderHighlights(); buildHero(); toast('Destaques atualizados');
    }
    function setAlbumCover(id){
      const albId = state.photos[id].albumId; if(!albId) return;
      state.albums[albId].cover = id; store.save(state); renderAlbums(); toast('Capa do √°lbum definida');
    }
    function updateCounts(id){
      // update inline badges where present (simple re-render via sections)
      renderHighlights();
      if($('#albumView').style.display==='block'){
        const albId = state.photos[id].albumId; openAlbum(albId);
      } else {
        renderAlbums();
      }
      // also update lightbox if open
      if(currentPhotoId===id) refreshLightboxCounts();
    }

    /* ======================================================
       LIGHTBOX + COMMENTS
    =======================================================*/
    const lightbox = $('#lightbox');
    const lbImg = $('#lightboxImg');
    const lbLike = $('#lbLike');
    const lbLikes = $('#lbLikes');
    const lbComments = $('#lbComments');
    const lbClose = $('#lbClose');
    const lbPrev = $('#lbPrev');
    const lbNext = $('#lbNext');

    let currentPhotoId = null;

    async function openLightbox(id){
      currentPhotoId = id;
      const rec = await idbGet(id); if(!rec) return;
      const url = URL.createObjectURL(rec.blob);
      lbImg.src = url;
      refreshLightboxCounts();
      lightbox.classList.add('open');
    }
    function refreshLightboxCounts(){
      lbLikes.textContent = state.likes[currentPhotoId]||0;
      lbComments.textContent = (state.comments[currentPhotoId]||[]).length;
    }
    lbClose.addEventListener('click', ()=> lightbox.classList.remove('open'));
    lbLike.addEventListener('click', ()=> likePhoto(currentPhotoId));

    // Prev/Next inside same album or highlight queue
    lbPrev.addEventListener('click', ()=> navigateLightbox(-1));
    lbNext.addEventListener('click', ()=> navigateLightbox(1));
    function getContextQueue(){
      // if album view visible, navigate within that album; else within highlights
      if($('#albumView').style.display==='block'){
        const albId = state.photos[currentPhotoId]?.albumId;
        return Object.keys(state.photos).filter(id=> state.photos[id].albumId===albId);
      }
      return state.highlights.length? state.highlights : Object.keys(state.photos);
    }
    async function navigateLightbox(dir){
      const queue = getContextQueue(); if(!queue.length) return;
      const idx = queue.indexOf(currentPhotoId);
      const next = queue[(idx + dir + queue.length) % queue.length];
      openLightbox(next);
    }

    // Comments modal (simple prompt UI)
    $('#lbCommentBtn').addEventListener('click', ()=>{
      const name = prompt('Seu nome (opcional):') || 'An√¥nimo(a)';
      const text = prompt('Seu coment√°rio:');
      if(!text) return;
      const arr = state.comments[currentPhotoId]||[];
      arr.push({name, text, ts: Date.now()});
      state.comments[currentPhotoId] = arr; store.save(state);
      updateCounts(currentPhotoId); toast('Coment√°rio adicionado');
    });

    /* ======================================================
       OWNER PANEL ‚Äî AUTH, THEME, ALBUMS, UPLOAD, MODEL
    =======================================================*/
    const drawer = $('#drawer');
    $('#ownerBtn').addEventListener('click', ()=> drawer.classList.toggle('open'));

    const ownerStatus = $('#ownerStatus');
    const ownerArea = $('#ownerArea');
    const ownerLoginBtn = $('#ownerLogin');
    ownerLoginBtn.addEventListener('click', ()=>{
      const pass = $('#ownerPass').value.trim();
      if(pass === 'alef1235'){
        sessionStorage.setItem('owner', '1');
        ownerStatus.textContent = 'Logado';
        ownerArea.style.display='block';
        toast('Bem-vindo ao Painel!');
      } else { toast('Senha incorreta'); }
    });
    // persist session
    if(sessionStorage.getItem('owner')==='1'){ ownerStatus.textContent='Logado'; ownerArea.style.display='block'; }

    // Theme
    $('#applyTheme').addEventListener('click', async()=>{
      const [p,a] = $('#themeSelect').value.split('|');
      const blur = $('#blurRange').value;
      state.theme.primary = p; state.theme.accent = a; state.theme.blur = blur;
      // bg image
      const file = $('#bgImageInput').files[0];
      if(file){ state.theme.bg = await fileToDataURL(file); }
      applyTheme(); store.save(state); toast('Tema aplicado');
    });
    $('#resetTheme').addEventListener('click', ()=>{ state.theme={}; applyTheme(); store.save(state); toast('Tema resetado') });

    function applyTheme(){
      document.documentElement.style.setProperty('--primary', state.theme.primary || '120 80 255');
      document.documentElement.style.setProperty('--accent', state.theme.accent || '255 110 84');
      document.documentElement.style.setProperty('--blur', (state.theme.blur||12) + 'px');
      if(state.theme.bg){
        document.body.style.backgroundImage = `url(${state.theme.bg})`;
        document.body.style.backgroundSize = 'cover';
        document.body.style.backgroundAttachment = 'fixed';
      } else {
        document.body.style.backgroundImage = '';
      }
    }

    // Albums mgmt
    function refreshAlbumsMgmt(){
      const list = $('#albumsList'); list.innerHTML='';
      const sel = $('#uploadAlbum'); sel.innerHTML='';
      Object.values(state.albums).forEach(alb=>{
        const row = document.createElement('div'); row.className='album-row';
        row.innerHTML = `<span class="pill">${alb.name}</span>`;
        const del = document.createElement('button'); del.className='btn'; del.textContent='Excluir';
        del.addEventListener('click', ()=>{
          if(confirm('Excluir √°lbum e suas refer√™ncias? As fotos continuar√£o no banco, mas sem v√≠nculo.')){
            delete state.albums[alb.id];
            Object.entries(state.photos).forEach(([pid,p])=>{ if(p.albumId===alb.id) p.albumId=''; });
            store.save(state); renderAlbums(); refreshAlbumsMgmt();
          }
        });
        row.appendChild(del);
        list.appendChild(row);

        const opt = document.createElement('option'); opt.value=alb.id; opt.textContent=alb.name; sel.appendChild(opt);
      });
    }

    $('#newAlbumBtn').addEventListener('click', ()=> drawer.classList.add('open'));
    $('#createAlbum').addEventListener('click', ()=>{
      if(sessionStorage.getItem('owner')!=='1'){ return toast('Fa√ßa login no painel.'); }
      const name = $('#albumName').value.trim(); if(!name) return;
      const id = uid(); state.albums[id] = {id, name}; store.save(state);
      $('#albumName').value=''; renderAlbums(); refreshAlbumsMgmt(); toast('√Ålbum criado');
    });

    // Upload
    const dropzone = $('#dropzone'); const fileInput = $('#fileInput');
    dropzone.addEventListener('click', ()=> fileInput.click());
    dropzone.addEventListener('dragover', e=>{ e.preventDefault(); dropzone.style.borderColor='rgba(255,255,255,.5)' });
    dropzone.addEventListener('dragleave', ()=> dropzone.style.borderColor='rgba(255,255,255,.2)');
    dropzone.addEventListener('drop', e=>{ e.preventDefault(); handleFiles(e.dataTransfer.files) });
    fileInput.addEventListener('change', e=> handleFiles(e.target.files));

    async function handleFiles(files){
      if(sessionStorage.getItem('owner')!=='1'){ return toast('Fa√ßa login no painel.'); }
      const alb = $('#uploadAlbum').value; if(!alb){ return toast('Selecione um √°lbum.'); }
      for(const file of files){
        if(!file.type.startsWith('image/')) continue;
        const id = uid();
        const blob = await fileToBlob(file);
        await idbPut({ id, albumId: alb, blob, type: file.type, createdAt: Date.now() });
        state.photos[id] = { albumId: alb, createdAt: Date.now(), featured:false };
        // define capa se n√£o houver
        if(!state.albums[alb].cover) state.albums[alb].cover = id;
      }
      store.save(state); renderAlbums(); openAlbum(alb); toast('Upload conclu√≠do');
    }

    function fileToBlob(file){ return new Promise(res=>{ const fr=new FileReader(); fr.onload=()=> res(new Blob([fr.result])); fr.readAsArrayBuffer(file); }) }
    function fileToDataURL(file){ return new Promise(res=>{ const fr=new FileReader(); fr.onload=()=> res(fr.result); fr.readAsDataURL(file); }) }

    // Highlights
    $('#rebuildHighlights').addEventListener('click', ()=>{ state.highlights = Object.keys(state.photos).filter(id=> state.photos[id].featured); store.save(state); renderHighlights(); buildHero(); toast('Destaques atualizados'); });

    // Model of the Week
    $('#saveModel').addEventListener('click', async()=>{
      if(sessionStorage.getItem('owner')!=='1'){ return toast('Fa√ßa login no painel.'); }
      state.model.name = $('#modelNameInput').value.trim();
      state.model.link = $('#modelLinkInput').value.trim();
      state.model.bio = $('#modelBioInput').value.trim();
      const f = $('#modelPhotoInput').files[0];
      if(f){ state.model.photo = await fileToDataURL(f); }
      store.save(state); renderModel(); toast('Modelo da semana salvo');
    });

    function renderModel(){
      $('#modelName').textContent = state.model.name || 'Nome do(a) modelo';
      $('#modelBio').textContent = state.model.bio || 'Biografia curta e links do destaque da semana.';
      const link = state.model.link || '#';
      const a = $('#modelLink'); a.href = link; a.style.display = state.model.link? 'inline-flex':'none';
      if(state.model.photo){ $('#modelPhoto').src = state.model.photo; $('#modelBadge').textContent = 'Atualizado'; }
      else { $('#modelPhoto').src = ''; $('#modelBadge').textContent = 'Atualize no painel'; }
    }

    // Tornar foto do modelo destaque (usa a imagem j√° definida)
    $('#featureModelBtn').addEventListener('click', async()=>{
      if(!state.model.photo) return toast('Defina a foto do modelo no painel.');
      // salva como foto sem √°lbum
      const id = uid();
      const res = await fetch(state.model.photo); const blob = await res.blob();
      await idbPut({ id, albumId: '', blob, type: blob.type, createdAt: Date.now() });
      state.photos[id] = { albumId:'', createdAt: Date.now(), featured:true };
      if(!state.highlights.includes(id)) state.highlights.unshift(id);
      store.save(state); renderHighlights(); buildHero(); toast('Modelo adicionado aos destaques');
    });

    // Export/Import (metadados + imagens pequenas)
    $('#exportData').addEventListener('click', async()=>{
      const data = JSON.parse(JSON.stringify(state));
      // N√ÉO exporta blobs grandes por padr√£o; mant√©m metadados e fotos do modelo/dos temas
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='portfolio-data.json'; a.click();
      URL.revokeObjectURL(url);
    });
    $('#importData').addEventListener('click', ()=> $('#importFile').click());
    $('#importFile').addEventListener('change', async(e)=>{
      const file = e.target.files[0]; if(!file) return;
      const text = await file.text();
      try{ const data = JSON.parse(text); state = data; store.save(state); applyTheme(); renderAll(); toast('Dados importados'); }
      catch{ toast('Arquivo inv√°lido'); }
    });
    $('#clearAll').addEventListener('click', async()=>{
      if(!confirm('Tem certeza? Isso limpar√° dados locais (√°lbuns, curtidas, coment√°rios).')) return;
      localStorage.removeItem(store.key);
      const db = await openDB(); db.close(); indexedDB.deleteDatabase(DB_NAME);
      state = store.load(); renderAll(); toast('Dados limpos');
    });

    /* ======================================================
       INIT
    =======================================================*/
    function renderAll(){ renderAlbums(); renderHighlights(); renderModel(); buildHero(); refreshAlbumsMgmt(); applyTheme(); }
    $('#year').textContent = new Date().getFullYear();
    renderAll();
  </script>
</body>
</html>
